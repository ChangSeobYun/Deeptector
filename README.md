# Deeptector Example Server

#### 1. 프로젝트 설명
#### 2. 프로젝트 개발 목적
#### 3. 시스템 구조
#### 4. 사용 시나리오
#### 5. 기대 효과

<br/>

## 1. 프로젝트 설명

최근 여러 매체를 통해 접할 수 있는 다수의 폭력 사건으로 인해 폭력 예방이나 묵인된 사건들까지 들추어낼 수 있는 시스템의 필요성이 느껴진다. 특히 사회적 약자가 머무르는 병원, 요양원, 유치원 등에서 발생한 폭력 사건은 더욱 즉각적인 대처가 필요하다. 이러한 문제를 해결하기 위해 곳곳에 CCTV가 설치되어 있지만 대부분이 기록용으로써 범죄 발생 후 많은 시간이 흐른 뒤에 추적 용도로만 쓰이고 있다. 이 경우, 외부의 여러 요인으로 인해 영상 데이터가 활용 불가능해질 수 있다. 따라서 폭력 사건을 사전 예방하거나 즉각 감지하여 빠른 대처를 하고, CCTV 모니터링 요원의 일을 자동화하는 시스템이 필요하다.  

과거 영상처리는 아날로그 기술로 이루어져 있었다. 현재는 컴퓨터의 처리속도가 향상한 만큼 디지털 영상처리 기법도 발전하여 많은 관련 기술 및 소프트웨어가 탄생하였다. 이러한 영상처리 기술은 머신 러닝 및 딥 러닝이 발전함에 따라 더욱 빛을 발휘하게 되고 아직도 각종 관련 기술들이 발전 중이다. 머신 러닝 기반 영상처리 기술에서 현재 가장 많이 사용되는 대표적인 기술은 CNN을 통한 객체 탐지 및 판별 기술이다. 하지만 이 기법은 정지된 영상에서 객체를 식별하고 탐지하는 기술로, 동영상 속 특정 객체의 행동 패턴을 실시간으로 분석하기에는 어려움이 있다고 판단하였다. 

이러한 한계를 극복해보고자 딥 러닝을 통하여 특정 객체의 행동을 실시간으로 분석, 판별하는 솔루션을 제시하게 되었다. 이에 따라, 본 프로젝트(이하 ‘Deeptector’)는 단순히 행동의 주체인 사람을 탐지만 하는 것이 아니라 딥 러닝을 기반으로 사람이 어떤 행동을 하고 있는지 실시간으로 감지할 수 있도록 구현하였다. 프로그램은 Ubuntu 환경의 PC에서 실행 가능하다. 감지 후에는 클라이언트에게 알림 서비스를 제공하며 이는 웹앱 형태로 제작되어 안드로이드 디바이스에서 사용 가능하다

<br/>

## 2. 프로젝트 개발 목적

- 실시간 폭력 감지  
> 현재는 폭력이 발생하면 뒤늦게 해당 CCTV가 있는 장소를 찾아 모니터링을 해야 하기 때문에 대처 속도가 신속하지 못한 문제점이 있다. 이를 해결하기 위해 사람의 폭력적인 동작을 학습시킨 모델을 이용하여 촬영 중인 영상에서 실시간으로 행동 패턴을 분석하고 폭력을 감지한다. 

- 어플리케이션을 통한 실시간 영상 기록 및 알림 확인  
> 실시간으로 촬영 중인 영상을 즉시 서버로 전송하여 분석하고, 서버가 폭력을 감지하면 클라이언트에게 알림을 보낸다. 실시간이 주된 목적이기 때문에 클라이언트는 바로 알림을 받을 수 있다. 폭력이 감지된 기록은 어플리케이션을 통해 확인할 수 있다. 내용은 폭력 발생 시점의 영상 일부와 폭력 발생 일시가 기록된다.

- 딥 러닝을 통한 신속한 행동 패턴 감지 
> 동영상 데이터에서 딥 러닝 기술을 이용해 사람 객체를 찾아내고 Human Pose 데이터를 추출한다. 해당 데이터는 총 18개로 코, 양쪽 눈, 양쪽 귀, 목, 양쪽 어깨, 양쪽 팔꿈치, 양쪽 손, 양쪽 골반, 양쪽 무릎, 양쪽 발로 이루어져 있다. 이 때, 동영상을 초 당 16프레임으로 나눈 뒤 해당 Human Pose 데이터를 활용하여 사람의 행동 패턴을 학습시키고, 학습된 모델을 이용해 실제 스트리밍 영상 속에서 행동 패턴을 감지한다. 학습, 분석, 감지 과정에서 딥 러닝 기술을 사용하였기 때문에 실시간 프로젝트에 알맞게 속도를 보다 빠르 향상시켰다.

- 여러 가지 행동 패턴 모델링 가능 
> ’Deeptector’의 궁극적 프로젝트 목표는 Real time action classification이다. 데모 프로젝트는 폭력을 감지하고 클라이언트에게 알려준다. 하지만 이러한 기능은 Real time action classification의 한 예이다. 따라서 폭력장면 뿐 만 아니라 사용자가 원하는 행동을 직접 학습하여 다른 용도로 활용이 가능하다. 또한 Customizing Model을 활용한 성능 개선 등 여러 방면으로 사용자의 필요에 따라 기능을 개선하여 사용할 수 있다.


<br/>

## 3. 시스템 구조

<br/>

<img width="800" src="https://user-images.githubusercontent.com/30898520/46716541-67e92880-cc9f-11e8-8e61-edf5adc0045c.png">

<br/>


CCTV나 IP 카메라와 연결된 RTSP 서버는 딥 러닝 서버와 클라이언트(안드로이드 어플리케이션)에게 현재 촬영 중인 영상 데이터를 전송한다. 클라이언트는 CCTV 영상을 실시간으로 모니터링 할 수 있고, 딥 러닝 서버는 받은 데이터에서 사람 객체를 판별한 후 폭행을 감지한다.

만약 딥 러닝 서버에서 폭행이 감지된다면 감지된 시점의 일부 동영상과 촬영 일시 데이터를 스프링 서버로 전송한다. 스프링은 데이터를 데이터베이스에 저장하고 불러와서 클라이언트에게 넘겨준다. 스프링은 백 엔드 처리를 하고 프론트 엔드는 React를 사용하여 웹 뷰를 표현하였다.

결과적으로 클라이언트는 RTSP 서버로부터 직접 받은 실시간 동영상 데이터와 
딥 러닝, 스프링 서버를 거쳐 받은 폭력 발생 시점의 데이터를 확인할 수 


<br/>

## 4. 사용 시나리오

<br/>

<img width="700" src="https://user-images.githubusercontent.com/30898520/46716638-d4fcbe00-cc9f-11e8-9105-f93e793de32a.png">

<br/>


사용자는 최초 실행 시 권한 여부를 확인해야 한다. 이 권한을 허가 해주어야 사용할 수 있으며, 이 권한은 후에 감지된 영상을 저장 및 열람을 할 수 있게 해주는 권한이다. 권한이 확인 된 후에는 홈 화면을 만나실 수 있다. 기능은 크게 2가지로 구분 된다. ‘LIST', 'CCTV'

첫 번째로 LIST 화면에서는 특정 행동이 감지되었을 시 웹 서버에 저장 된 영상들의 목록을 확인 할 수 있다. 더 많은 목록들을 보고 싶다면 화면 하단 화살표 ‘❮❯’ 버튼을 클릭하여 다른 영상들의 목록을 더 확인 할 수 있다. 

이와 더불어 영상 이름 우측에 표시되어 있는 폴더() 모양의 아이콘을 클릭하면 서버 데이터베이스 내에 있는 영상을 다운로드(저장)하여 클라이언트 내에서 볼 수 있다. 원하는 영상을 여러 개 요청 할 수 있으며, 영상 다운이 완료 될 때마다 알림 메시지(Notification)를 통해 확인 할 수 있다.

다운로드가 완료 된 영상은 화면 우측 하단에 있는 ‘플로팅 아이콘()’을 누르면 저장 했었던 영상들과 함께 선택한 영상을 재생시킬 수 있는 화면으로 넘어가게 된다. 

두 번째로 CCTV 화면에서는 현재 카메라에 담기고 있는 영상을 실시간으로 확인해 볼 수 있다. 만약 사용자가 다른 용무를 보고 있는 중에 특정 행동이 감지가 되면 알림 메시지와 경고음을 함께 사용자에게 알려주며, 바로 이 화면을 통해서 어떠한 일이 생기고 있는지 실시간으로 확인을 할 수 있는 것이다.


<br/>

## 5. 기대 효과

- 신속하고 편리한 행동 감지 

> ’Deeptector’는 기존 CCTV 시스템 대비 빠르고 편리한 폭력 감지가 목표이다. 매체 조사에 따르면 기존 CCTV 시스템은 관제 요원이 감시를 하더라도 모니터링 시작 후 22분이 지난 후에 약 95%의 감시 오류가 발생한다는 실험 결과가 있다. (출처: NIJ <Ministry of Justice, USA>, Buyer Beware Vol.10/11, 2002) 이에 따라 기존의 CCTV를 일일이 사람이 관찰하는 방법은 관제 능력이 현저하게 떨어진다는 것을 알 수 있다. 하지만 ‘Deeptector’는 실시간 행동 탐지가 가능하게 만들어졌다. 현재 완성한 프로그램은 반복적으로 보완하여 초기 프로그램에 비해 더욱 빠른 행동 탐지가 가능하다. 초 당 25프레임의 영상 데이터에서도 학습시킨 행동을 탐지할 수 있다. 따라서 기존 시스템에 ’Deeptector’ 시스템을 도입하여 사람과 협업하거나 1차 모니터링 서비스를 제공한다면 관제 능력은 훨씬 향상 될 것이다.

- 우수한 확장성 

> 단순히 폭행 감지용도 뿐만 아니라 학습시키는 행동 종류에 따라 지속적인 실시간 탐지와 정보 분석이 가능하며, 그에 따른 경고나 알림 서비스를 통해 실시간 관제 능력을 획기적으로 향상 시킬 수 있다. 대표적으로 방화, 도난 등의 행동이 있으며, 필요로 하는 행동에 대해 학습하여 다양한 용도로 확장 시킬 수 있다.

- 폭력 사건 사전 예방 

> 폭력 사건 및 사고는 장시간 이어지는 경우가 많다. 하지만 ‘Deeptector‘ 시스템을 통해 빠른 1차 검출에 성공한다면 처음 폭력을 휘두른 직후 이어지는 폭력에 대해 빠르게 대처할 수 있는 효과를 지닌다. 또한 CCTV를 통해 폭행이 실시간으로 검출된다는 사실을 다수의 사람들이 알게 된다면 충동적으로 발생하는 폭행 사건의 수가 기존보다 감소할 것이라고 예상한다.
